<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:conv="clr-namespace:BankSystem.UI.Converters"
             xmlns:controls="clr-namespace:Avalonia.Controls;assembly=Avalonia.Controls.DataGrid"
             x:Class="BankSystem.UI.Views.AccountsView">
  <UserControl.Resources>
    <conv:MaskingConverter x:Key="MaskingConverter"/>
  </UserControl.Resources>
  
  <StackPanel Spacing="24">
    <!-- Header -->
    <StackPanel Spacing="8">
      <TextBlock Text="Mis Cuentas" FontSize="32" FontWeight="Bold" Foreground="#1E293B"/>
      <TextBlock Text="Gestiona tus cuentas y tarjetas" FontSize="14" Foreground="#64748B"/>
    </StackPanel>

    <!-- Visual Cards Grid -->
    <ScrollViewer HorizontalScrollBarVisibility="Auto">
      <ItemsControl ItemsSource="{Binding Accounts}">
        <ItemsControl.ItemsPanel>
          <ItemsPanelTemplate>
            <WrapPanel Orientation="Horizontal"/>
          </ItemsPanelTemplate>
        </ItemsControl.ItemsPanel>
        
        <ItemsControl.ItemTemplate>
          <DataTemplate>
            <Border Classes="card" 
                    Width="340" 
                    Height="200" 
                    Margin="0,0,20,20">
              <Border.Background>
                <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                  <GradientStop Color="#FF6B35" Offset="0"/>
                  <GradientStop Color="#F7931E" Offset="1"/>
                </LinearGradientBrush>
              </Border.Background>
              <Grid RowDefinitions="Auto,*,Auto">
                <!-- Card Header -->
                <Grid Grid.Row="0" ColumnDefinitions="*,Auto">
                  <TextBlock Grid.Column="0" Text="{Binding Type}" 
                             FontSize="14" 
                             FontWeight="Bold" 
                             Foreground="White"
                             Opacity="0.9"/>
                  <TextBlock Grid.Column="1" Text="ðŸ’³" FontSize="24"/>
                </Grid>

                <!-- Card Number -->
                <StackPanel Grid.Row="1" VerticalAlignment="Center" Spacing="12">
                  <TextBlock Text="{Binding Number, Converter={StaticResource MaskingConverter}, ConverterParameter=account}" 
                             FontSize="20" 
                             FontWeight="Bold" 
                             Foreground="White"
                             LetterSpacing="2"/>
                  <TextBlock Text="{Binding Balance, StringFormat='Saldo: {0:C}'}" 
                             FontSize="28" 
                             FontWeight="Bold" 
                             Foreground="White"/>
                </StackPanel>

                <!-- Card Footer -->
                <Grid Grid.Row="2" ColumnDefinitions="*,Auto">
                  <StackPanel Grid.Column="0">
                    <TextBlock Text="ESTADO" 
                               FontSize="10" 
                               Foreground="White" 
                               Opacity="0.7"/>
                    <TextBlock Text="{Binding Status}" 
                               FontSize="14" 
                               FontWeight="Bold" 
                               Foreground="White"/>
                  </StackPanel>
                  <StackPanel Grid.Column="1">
                    <TextBlock Text="MONEDA" 
                               FontSize="10" 
                               Foreground="White" 
                               Opacity="0.7"
                               HorizontalAlignment="Right"/>
                    <TextBlock Text="{Binding Currency}" 
                               FontSize="14" 
                               FontWeight="Bold" 
                               Foreground="White"
                               HorizontalAlignment="Right"/>
                  </StackPanel>
                </Grid>
              </Grid>
            </Border>
          </DataTemplate>
        </ItemsControl.ItemTemplate>
      </ItemsControl>
    </ScrollViewer>

    <!-- Create Account Section -->
    <Border Classes="card">
      <StackPanel Spacing="16">
        <TextBlock Text="âž• Crear Nueva Cuenta" FontSize="18" FontWeight="Bold" Foreground="#1E293B"/>
        
        <Grid ColumnDefinitions="*,*,*" RowDefinitions="Auto,Auto" ColumnSpacing="12" RowSpacing="12">
          <StackPanel Grid.Column="0" Grid.Row="0">
            <TextBlock Text="ID Cliente" FontSize="12" FontWeight="Medium" Foreground="#64748B" Margin="0,0,0,4"/>
            <NumericUpDown Value="{Binding NewCustomerId}" 
                           Minimum="1" 
                           Maximum="999999"
                           Height="42"
                           CornerRadius="8"/>
          </StackPanel>

          <StackPanel Grid.Column="1" Grid.Row="0">
            <TextBlock Text="Tipo de Cuenta" FontSize="12" FontWeight="Medium" Foreground="#64748B" Margin="0,0,0,4"/>
            <ComboBox SelectedIndex="{Binding NewAccountTypeIndex}"
                      Height="42"
                      CornerRadius="8"
                      HorizontalAlignment="Stretch">
              <ComboBoxItem Content="ðŸ’° Ahorro"/>
              <ComboBoxItem Content="ðŸ’³ Corriente"/>
              <ComboBoxItem Content="ðŸ“ˆ Certificado de DepÃ³sito"/>
            </ComboBox>
          </StackPanel>

          <StackPanel Grid.Column="2" Grid.Row="0">
            <TextBlock Text="Moneda" FontSize="12" FontWeight="Medium" Foreground="#64748B" Margin="0,0,0,4"/>
            <ComboBox SelectedIndex="{Binding NewCurrencyIndex}"
                      Height="42"
                      CornerRadius="8"
                      HorizontalAlignment="Stretch">
              <ComboBoxItem Content="ðŸ‡ºðŸ‡¸ USD"/>
              <ComboBoxItem Content="ðŸ‡ªðŸ‡º EUR"/>
              <ComboBoxItem Content="ðŸ‡¬ðŸ‡§ GBP"/>
            </ComboBox>
          </StackPanel>

          <Button Grid.Column="0" Grid.Row="1" Grid.ColumnSpan="3"
                  Classes="primary"
                  Content="âœ¨ Crear Cuenta" 
                  Command="{Binding CreateAccountCommand}"
                  Height="48"
                  FontSize="15"
                  FontWeight="SemiBold"/>
        </Grid>
      </StackPanel>
    </Border>

    <!-- Action Panel -->
    <Border Classes="card">
      <StackPanel Spacing="16">
        <TextBlock Text="Operaciones" FontSize="18" FontWeight="Bold" Foreground="#1E293B"/>
        
        <Grid ColumnDefinitions="Auto,*">
          <TextBlock Grid.Column="0" Text="Monto:" VerticalAlignment="Center" FontWeight="Medium" Margin="0,0,12,0"/>
          <NumericUpDown Grid.Column="1" 
                         Minimum="0" 
                         Maximum="1000000" 
                         Value="{Binding Amount}"
                         CornerRadius="8"
                         Height="40"/>
        </Grid>

        <WrapPanel>
          <Button Classes="success" Content="ðŸ’µ Depositar" Command="{Binding DepositCommand}" Margin="0,0,12,0"/>
          <Button Classes="danger" Content="ðŸ’¸ Retirar" Command="{Binding WithdrawCommand}" Margin="0,0,12,0"/>
          <Button Classes="primary" Content="ðŸ”„ Transferir" Command="{Binding TransferCommand}" Margin="0,0,12,0"/>
          <Button Classes="danger" Content="ðŸ”’ Desactivar Tarjeta" Command="{Binding FreezeCommand}" Margin="0,0,12,0"/>
          <Button Classes="success" Content="ðŸ”“ Activar Tarjeta" Command="{Binding UnfreezeCommand}" Margin="0,0,12,0"/>
        </WrapPanel>

        <TextBlock Text="{Binding Status}" 
                   FontSize="14" 
                   Foreground="#10B981" 
                   FontWeight="Medium"
                   IsVisible="{Binding Status, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
      </StackPanel>
    </Border>

    <!-- Detailed Table View -->
    <Border Classes="card">
      <StackPanel Spacing="16">
        <TextBlock Text="Lista Detallada" FontSize="18" FontWeight="Bold" Foreground="#1E293B"/>
        <controls:DataGrid ItemsSource="{Binding Accounts}" 
                          AutoGenerateColumns="False" 
                          SelectedItem="{Binding SelectedAccount}"
                          GridLinesVisibility="None"
                          Background="Transparent"
                          RowBackground="#F8FAFC"
                          HeadersVisibility="Column">
          <controls:DataGrid.Columns>
            <controls:DataGridTextColumn Header="Cuenta" Binding="{Binding Number, Converter={StaticResource MaskingConverter}, ConverterParameter=account}" Width="*"/>
            <controls:DataGridTextColumn Header="Tipo" Binding="{Binding Type}" Width="*"/>
            <controls:DataGridTextColumn Header="Moneda" Binding="{Binding Currency}" Width="80"/>
            <controls:DataGridTextColumn Header="Balance" Binding="{Binding Balance, StringFormat='{}{0:C}'}" Width="*"/>
            <controls:DataGridTextColumn Header="Estado" Binding="{Binding Status}" Width="100"/>
            <controls:DataGridTextColumn Header="Cliente" Binding="{Binding CustomerId}" Width="100"/>
          </controls:DataGrid.Columns>
        </controls:DataGrid>
      </StackPanel>
    </Border>
  </StackPanel>
</UserControl>
